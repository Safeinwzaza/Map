<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Google Maps Navigation Clone</title>

<style>
html, body {
  margin: 0;
  padding: 0;
  height: 100%;
  font-family: system-ui, -apple-system, sans-serif;
}

#map {
  height: 100%;
  width: 100%;
}

/* ===== Top Card ===== */
#topCard {
  position: absolute;
  top: 12px;
  left: 50%;
  transform: translateX(-50%);
  background: white;
  padding: 12px 16px;
  border-radius: 14px;
  box-shadow: 0 4px 12px rgba(0,0,0,.25);
  z-index: 10;
  font-size: 15px;
  display: none;
}

/* ===== Bottom Sheet ===== */
#bottomSheet {
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  background: white;
  border-radius: 18px 18px 0 0;
  padding: 18px;
  box-shadow: 0 -4px 12px rgba(0,0,0,.3);
  z-index: 10;
  display: none;
}

#bottomSheet h3 {
  margin: 0 0 6px;
}

.btn {
  position: absolute;
  right: 14px;
  background: white;
  border: none;
  border-radius: 50%;
  padding: 14px;
  box-shadow: 0 3px 8px rgba(0,0,0,.3);
  font-size: 18px;
  z-index: 10;
}

#locBtn { bottom: 150px; }
#navBtn { bottom: 90px; }
</style>
</head>

<body>

<div id="map"></div>

<div id="topCard"></div>

<div id="bottomSheet">
  <h3 id="summary">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ô‡∏≥‡∏ó‡∏≤‡∏á</h3>
  <div id="distance">‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á: -</div>
  <div id="time">‡πÄ‡∏ß‡∏•‡∏≤: -</div>
</div>

<button id="locBtn" class="btn">üìç</button>
<button id="navBtn" class="btn">üß≠</button>

<script
  src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAzp3dsvPcpo6j91UXZn1lFn6zmyOfsv9A&libraries=geometry">
</script>

<script>
let map, userMarker, destMarker, directionsService, directionsRenderer;
let watchId;
let steps = [];
let stepIndex = 0;

/* ===== INIT MAP ===== */
function initMap() {
  map = new google.maps.Map(document.getElementById("map"), {
    center: { lat: 16.7469, lng: 100.1969 },
    zoom: 17,
    tilt: 45,
    heading: 0,
    disableDefaultUI: true
  });

  directionsService = new google.maps.DirectionsService();
  directionsRenderer = new google.maps.DirectionsRenderer({
    suppressMarkers: true,
    polylineOptions: {
      strokeColor: "#1e88ff",
      strokeWeight: 6
    }
  });
  directionsRenderer.setMap(map);

  /* Destination B */
  destMarker = new google.maps.Marker({
    position: { lat: 16.7479, lng: 100.1947 },
    map,
    icon: "https://maps.gstatic.com/mapfiles/ms2/micons/red-dot.png"
  });

  trackUser();
}

/* ===== USER TRACKING ===== */
function trackUser() {
  watchId = navigator.geolocation.watchPosition(pos => {
    const lat = pos.coords.latitude;
    const lng = pos.coords.longitude;
    const heading = pos.coords.heading || 0;

    if (!userMarker) {
      userMarker = new google.maps.Marker({
        position: { lat, lng },
        map,
        icon: {
          path: google.maps.SymbolPath.FORWARD_CLOSED_ARROW,
          scale: 5,
          fillColor: "#1e88ff",
          fillOpacity: 1,
          strokeWeight: 2,
          rotation: heading
        }
      });
      map.setCenter({ lat, lng });
    } else {
      userMarker.setPosition({ lat, lng });
      userMarker.setIcon({
        path: google.maps.SymbolPath.FORWARD_CLOSED_ARROW,
        scale: 5,
        fillColor: "#1e88ff",
        fillOpacity: 1,
        strokeWeight: 2,
        rotation: heading
      });
    }

    map.setHeading(heading);

    checkStep(lat, lng);
  }, null, { enableHighAccuracy: true });
}

/* ===== START NAV ===== */
function startNavigation() {
  directionsService.route({
    origin: userMarker.getPosition(),
    destination: destMarker.getPosition(),
    travelMode: "DRIVING"
  }, res => {
    directionsRenderer.setDirections(res);

    const leg = res.routes[0].legs[0];
    steps = leg.steps;
    stepIndex = 0;

    document.getElementById("topCard").style.display = "block";
    document.getElementById("bottomSheet").style.display = "block";

    document.getElementById("distance").innerText =
      `‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á: ${(leg.distance.value/1000).toFixed(2)} ‡∏Å‡∏°.`;
    document.getElementById("time").innerText =
      `‡πÄ‡∏ß‡∏•‡∏≤: ${(leg.duration.value/60).toFixed(1)} ‡∏ô‡∏≤‡∏ó‡∏µ`;

    speak(stripHtml(steps[0].instructions));
  });
}

/* ===== CHECK TURN ===== */
function checkStep(lat, lng) {
  if (!steps[stepIndex]) return;

  const dist = google.maps.geometry.spherical.computeDistanceBetween(
    new google.maps.LatLng(lat, lng),
    steps[stepIndex].end_location
  );

  if (dist < 20 && stepIndex < steps.length - 1) {
    stepIndex++;
    const text = stripHtml(steps[stepIndex].instructions);
    document.getElementById("topCard").innerText = text;
    speak(text);
  }
}

/* ===== SPEECH ===== */
function speak(text) {
  const u = new SpeechSynthesisUtterance(text);
  u.lang = "th-TH";
  speechSynthesis.cancel();
  speechSynthesis.speak(u);
}

function stripHtml(html) {
  return html.replace(/<[^>]*>/g, "");
}

/* ===== BUTTONS ===== */
navBtn.onclick = startNavigation;
locBtn.onclick = () => {
  if (userMarker) map.panTo(userMarker.getPosition());
};

initMap();
</script>

</body>
</html>