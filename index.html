<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <title>LIFF Real-time Map</title>

  <!-- Leaflet CSS -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
  />

  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
    }

    #map {
      width: 100%;
      height: 100%;
    }

    .map-btn {
      position: absolute;
      left: 10px;
      z-index: 1000;
      padding: 8px 12px;
      background: white;
      border: 1px solid #ccc;
      border-radius: 6px;
      cursor: pointer;
    }

    #focusUserBtn {
      top: 10px;
    }

    #navigateBtn {
      top: 60px;
    }
  </style>
</head>
<body>

  <button id="focusUserBtn" class="map-btn">üìç ‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡∏´‡∏≤‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏â‡∏±‡∏ô</button>
  <button id="navigateBtn" class="map-btn">üß≠ ‡∏ô‡∏≥‡∏ó‡∏≤‡∏á‡πÑ‡∏õ‡∏´‡∏≤ B</button>

  <div id="map"></div>

  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <script>
    /* =========================
       1) ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà
    ========================= */
    const map = L.map('map').setView([13.7563, 100.5018], 15);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '¬© OpenStreetMap contributors'
    }).addTo(map);

    /* =========================
       2) ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á B (‡∏à‡∏≥‡∏•‡∏≠‡∏á)
    ========================= */
    let bLat = 13.7563;
    let bLng = 100.5018;

    const bMarker = L.marker([bLat, bLng])
      .addTo(map)
      .bindPopup('‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á B');

    function updateBLocation() {
      bLat += (Math.random() - 0.5) * 0.001;
      bLng += (Math.random() - 0.5) * 0.001;
      bMarker.setLatLng([bLat, bLng]);
    }

    setInterval(updateBLocation, 5000);

    /* =========================
       3) ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á A (‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ)
    ========================= */
    let userLat = null;
    let userLng = null;
    let userMarker = null;

    if (navigator.geolocation) {
      navigator.geolocation.watchPosition(
        function (position) {
          userLat = position.coords.latitude;
          userLng = position.coords.longitude;

          if (!userMarker) {
            userMarker = L.marker([userLat, userLng])
              .addTo(map)
              .bindPopup('‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì')
              .openPopup();
          } else {
            userMarker.setLatLng([userLat, userLng]);
          }
        },
        function () {
          alert('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ');
        },
        {
          enableHighAccuracy: true,
          maximumAge: 5000,
          timeout: 10000
        }
      );
    } else {
      alert('‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö GPS');
    }

    /* =========================
       4) ‡∏õ‡∏∏‡πà‡∏°‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡∏´‡∏≤‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á A
    ========================= */
    document.getElementById('focusUserBtn').addEventListener('click', () => {
      if (userLat && userLng) {
        map.setView([userLat, userLng], 16);
      }
    });

    /* =========================
       5) ‡∏õ‡∏∏‡πà‡∏°‡∏ô‡∏≥‡∏ó‡∏≤‡∏á‡πÑ‡∏õ‡∏´‡∏≤ B
    ========================= */
    document.getElementById('navigateBtn').addEventListener('click', () => {
      const url =
        `https://www.google.com/maps/dir/?api=1&destination=${bLat},${bLng}`;
      window.open(url, '_blank');
    });
  </script>

</body>
</html>