<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <title>LIFF Live Navigation</title>

  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

  <!-- Routing -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.css"/>

  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
    }

    #map {
      width: 100%;
      height: 100%;
    }

    /* Floating buttons (‡πÉ‡∏´‡∏ç‡πà‡∏Ç‡∏∂‡πâ‡∏ô) */
    .fab {
      position: absolute;
      right: 18px;
      z-index: 1000;
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: white;
      border: none;
      box-shadow: 0 4px 10px rgba(0,0,0,0.35);
      font-size: 26px;
      cursor: pointer;
    }

    #focusBtn { top: 20px; }
    #routeBtn { top: 100px; }
    #clearBtn { top: 180px; }

    /* Bottom info card (‡πÉ‡∏´‡∏ç‡πà + ‡∏≠‡πà‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢) */
    #infoCard {
      position: absolute;
      bottom: 24px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 1000;
      background: white;
      border-radius: 20px;
      padding: 18px 28px;
      min-width: 300px;
      box-shadow: 0 5px 14px rgba(0,0,0,0.3);
      text-align: center;
    }

    #infoCard b {
      font-size: 20px;
    }

    #infoCard span {
      display: block;
      margin-top: 6px;
      font-size: 16px;
      color: #444;
    }
  </style>
</head>
<body>

  <button id="focusBtn" class="fab">üìç</button>
  <button id="routeBtn" class="fab">üß≠</button>
  <button id="clearBtn" class="fab">‚úñ</button>

  <div id="infoCard">
    <b>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ô‡∏≥‡∏ó‡∏≤‡∏á</b>
    <span>‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á - | ‡πÄ‡∏ß‡∏•‡∏≤ -</span>
  </div>

  <div id="map"></div>

  <!-- JS -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://unpkg.com/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.js"></script>

  <script>
    /* ======================
       MAP (OSM ‡∏õ‡∏Å‡∏ï‡∏¥ ‡∏°‡∏µ‡∏™‡∏µ ‡∏°‡∏µ‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà)
    ====================== */
    const map = L.map('map', { zoomControl: false })
      .setView([16.7469, 100.1969], 15);

    L.tileLayer(
      'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',
      { attribution: '¬© OpenStreetMap contributors' }
    ).addTo(map);

    map.setMinZoom(13);
    map.setMaxZoom(18);

    /* ======================
       MARKERS (Google-like circle)
    ====================== */
    let userLat, userLng;
    let bLat = 16.7479;
    let bLng = 100.1947;

    const userMarker = L.circleMarker([0,0], {
      radius: 10,
      color: '#ffffff',
      weight: 3,
      fillColor: '#1A73E8',
      fillOpacity: 1
    }).addTo(map);

    const bMarker = L.circleMarker([bLat, bLng], {
      radius: 10,
      color: '#ffffff',
      weight: 3,
      fillColor: '#EA4335',
      fillOpacity: 1
    }).addTo(map);

    /* ======================
       GPS USER (A)
    ====================== */
    navigator.geolocation.watchPosition(pos => {
      userLat = pos.coords.latitude;
      userLng = pos.coords.longitude;
      userMarker.setLatLng([userLat, userLng]);
      updateRoute();
    }, null, { enableHighAccuracy: true });

    /* ======================
       ROUTING (reroute realtime)
    ====================== */
    let routingControl = null;

    function startRoute() {
      if (!userLat || !userLng) return;

      if (!routingControl) {
        routingControl = L.Routing.control({
          waypoints: [
            L.latLng(userLat, userLng),
            L.latLng(bLat, bLng)
          ],
          addWaypoints: false,
          draggableWaypoints: false,
          show: false,
          createMarker: () => null,
          lineOptions: {
            styles: [
              { color: '#444', weight: 10 },
              { color: '#1A73E8', weight: 6 }
            ]
          }
        }).addTo(map);

        routingControl.on('routesfound', e => {
          const r = e.routes[0].summary;
          document.getElementById('infoCard').innerHTML = `
            <b>${(r.totalDistance / 1000).toFixed(2)} ‡∏Å‡∏°.</b>
            <span>‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì ${(r.totalTime / 60).toFixed(1)} ‡∏ô‡∏≤‡∏ó‡∏µ</span>
          `;
        });
      }
    }

    function updateRoute() {
      if (routingControl && userLat && userLng) {
        routingControl.setWaypoints([
          L.latLng(userLat, userLng),
          L.latLng(bLat, bLng)
        ]);
      }
    }

    /* ======================
       SIMULATE B MOVE
    ====================== */
    setInterval(() => {
      bLat += (Math.random() - 0.5) * 0.0004;
      bLng += (Math.random() - 0.5) * 0.0004;
      bMarker.setLatLng([bLat, bLng]);
      updateRoute();
    }, 5000);

    /* ======================
       BUTTONS
    ====================== */
    document.getElementById('focusBtn').onclick = () => {
      if (userLat && userLng) {
        map.setView([userLat, userLng], 16);
      }
    };

    document.getElementById('routeBtn').onclick = startRoute;

    document.getElementById('clearBtn').onclick = () => {
      if (routingControl) {
        map.removeControl(routingControl);
        routingControl = null;
        document.getElementById('infoCard').innerHTML =
          `<b>‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡∏ô‡∏≥‡∏ó‡∏≤‡∏á</b><span>‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á - | ‡πÄ‡∏ß‡∏•‡∏≤ -</span>`;
      }
    };
  </script>

</body>
</html>