<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
<title>Google Maps Navigation UI</title>

<style>
html, body {
  margin: 0;
  height: 100%;
  font-family: system-ui, -apple-system, sans-serif;
}
#map { height: 100%; }

/* ===== Top instruction ===== */
#top {
  position: absolute;
  top: 14px;
  left: 50%;
  transform: translateX(-50%);
  background: #1f5eff;
  color: white;
  padding: 12px 18px;
  border-radius: 14px;
  font-size: 16px;
  box-shadow: 0 4px 12px rgba(0,0,0,.35);
  z-index: 10;
  display: none;
}

/* ===== Bottom Sheet ===== */
#bottom {
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  background: white;
  border-radius: 22px 22px 0 0;
  padding: 18px;
  box-shadow: 0 -4px 14px rgba(0,0,0,.3);
  z-index: 10;
  display: none;
}
#bottom h3 {
  margin: 0 0 6px;
}
#bottom .row {
  font-size: 16px;
}

/* ===== Floating Buttons ===== */
.btn {
  position: absolute;
  right: 14px;
  width: 52px;
  height: 52px;
  border-radius: 50%;
  background: white;
  border: none;
  font-size: 22px;
  box-shadow: 0 3px 10px rgba(0,0,0,.3);
  z-index: 10;
}
#loc { bottom: 160px; }
#nav { bottom: 95px; background:#1f5eff; color:white; }
</style>
</head>

<body>

<div id="map"></div>
<div id="top"></div>

<div id="bottom">
  <h3>üß≠ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ô‡∏≥‡∏ó‡∏≤‡∏á</h3>
  <div class="row" id="dist">‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á: -</div>
  <div class="row" id="time">‡πÄ‡∏ß‡∏•‡∏≤: -</div>
</div>

<button id="loc" class="btn">üìç</button>
<button id="nav" class="btn">‚ñ∂</button>

<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAzp3dsvPcpo6j91UXZn1lFn6zmyOfsv9A&libraries=geometry"></script>

<script>
let map, userMarker, destMarker;
let directionsService, directionsRenderer;
let steps = [], stepIndex = 0;

/* ===== INIT MAP ===== */
function init() {
  map = new google.maps.Map(document.getElementById("map"), {
    center: { lat: 16.7469, lng: 100.1969 },
    zoom: 18,
    tilt: 45,
    heading: 0,
    disableDefaultUI: true
  });

  directionsService = new google.maps.DirectionsService();
  directionsRenderer = new google.maps.DirectionsRenderer({
    suppressMarkers: true,
    polylineOptions: {
      strokeColor: "#1f5eff",
      strokeWeight: 6
    }
  });
  directionsRenderer.setMap(map);

  /* Marker B (‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á) */
  destMarker = new google.maps.Marker({
    position: { lat: 16.7479, lng: 100.1947 },
    map,
    icon: "https://maps.gstatic.com/mapfiles/ms2/micons/red-dot.png"
  });

  trackUser();
}

/* ===== TRACK USER ===== */
function trackUser() {
  navigator.geolocation.watchPosition(p => {
    const lat = p.coords.latitude;
    const lng = p.coords.longitude;
    const heading = p.coords.heading || 0;

    const icon = {
      path: google.maps.SymbolPath.FORWARD_CLOSED_ARROW,
      scale: 6,
      fillColor: "#1f5eff",
      fillOpacity: 1,
      strokeWeight: 2,
      rotation: heading
    };

    if (!userMarker) {
      userMarker = new google.maps.Marker({
        position: { lat, lng },
        map,
        icon
      });
      map.setCenter({ lat, lng });
    } else {
      userMarker.setPosition({ lat, lng });
      userMarker.setIcon(icon);
    }

    map.setHeading(heading);
    checkStep(lat, lng);

  }, null, { enableHighAccuracy: true });
}

/* ===== START NAVIGATION ===== */
function startNav() {
  directionsService.route({
    origin: userMarker.getPosition(),
    destination: destMarker.getPosition(),
    travelMode: "DRIVING"
  }, res => {
    directionsRenderer.setDirections(res);

    const leg = res.routes[0].legs[0];
    steps = leg.steps;
    stepIndex = 0;

    document.getElementById("top").style.display = "block";
    document.getElementById("bottom").style.display = "block";

    document.getElementById("dist").innerText =
      `‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á: ${(leg.distance.value/1000).toFixed(2)} ‡∏Å‡∏°.`;
    document.getElementById("time").innerText =
      `‡πÄ‡∏ß‡∏•‡∏≤: ${(leg.duration.value/60).toFixed(1)} ‡∏ô‡∏≤‡∏ó‡∏µ`;

    updateInstruction();
  });
}

/* ===== TURN CHECK ===== */
function checkStep(lat, lng) {
  if (!steps[stepIndex]) return;

  const d = google.maps.geometry.spherical.computeDistanceBetween(
    new google.maps.LatLng(lat, lng),
    steps[stepIndex].end_location
  );

  if (d < 20 && stepIndex < steps.length - 1) {
    stepIndex++;
    updateInstruction();
  }
}

function updateInstruction() {
  const text = steps[stepIndex].instructions.replace(/<[^>]*>/g, "");
  document.getElementById("top").innerText = text;
}

/* ===== BUTTONS ===== */
nav.onclick = startNav;
loc.onclick = () => userMarker && map.panTo(userMarker.getPosition());

init();
</script>

</body>
</html>